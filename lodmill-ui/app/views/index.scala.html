@* Copyright 2012-2013 Fabian Steeg. Licensed under the Eclipse Public License 1.0 *@

@(index: controllers.Index, query: String, category: String, resultFormat: String)

@import controllers.Serialization
@import controllers.Index

@main("Lobid API - Index") {
    <h2>Basic API usage</h2>
    <p>The API currently supports queries for lobid resources (by ID and author name), lobid organisations, and GND entries (both by name), e.g.:</p>
    <pre>GET /id/HT002189125 ; GET /author/Abramson ; GET /author/Abramson?index=@Index.GND.id() ; GET /search?index=@Index.LOBID_ORGANISATIONS.id()&amp;category=title&amp;query=Escola&amp;format=page</pre>
    <p>See the form below for additional usage samples and optional parameters.</p>

	<h2>Content Negotiation</h2>
	<p>To return different RDF serializations as the result format (default is JSON-LD), you can specify an accept header, e.g. for N-Triples:</p>
	<pre>curl --header "Accept: text/plain" http://api.lobid.org/id/HT002189125</pre>
	<p>Currently supported: @Serialization.values().map((s:Serialization) => s.name + " " + s.getTypes).mkString(", ")</p>

	<h2>API request form</h2>
	<p>Use the form below to set up your query parameters (index, category, result format):
	<form action="@routes.Application.config(index.id(), category, resultFormat)" class="form-inline" method="GET">
		<!-- TODO: create a custom tag and extract the common code of these 3 option divs: -->
	    <label class="control-label" for="index">index:</label>
		<!-- We submit on change to update the valid categories for the index: -->
		<select name="index" id="index" onChange="this.form.submit()">
			@for(indexOption <- DocumentHelper.searchFieldsMap.keySet()){
				<option value="@indexOption" @if(indexOption == index) {selected="selected"} else{}>
					@indexOption
				</option>
			}
		</select>
	    <label class="control-label" for="category">category:</label>
		<select name="category" id="category">
			@for(categoryOption<-DocumentHelper.searchFieldsMap.get(index).keySet()){
				<option value="@categoryOption" @if(categoryOption == category) {selected="selected"} else{}>
					@categoryOption
				</option>
			}
		</select>
		<label class="control-label" for="format">format:</label>
		<select name="format" id="format">
			@for(formatOption <- controllers.ResultFormat.values().map(_.toString.toLowerCase)){
				<option value="@formatOption"  @if(formatOption == resultFormat) {selected="selected"} else{}>
					@formatOption
				</option>
			}
		</select>
		<button type="submit" class="btn">Update</button>
	</form>
	<p>After confirming the parameters above using the 'Update' button, you will get auto-suggestions in the query field below (based on the 'short' result format):</p>
    <form action="@routes.Application.search(index.id(), category, resultFormat, query)" class="form-inline" method="GET">
		<input type='hidden' name='format' value='@resultFormat' />
		<input type='hidden' name='index' value='@index.id()' />
		<input type='hidden' name='category' value='@category' />
	    <label class="control-label" for="query">GET /search with parameters set above and query:</label>
	    <input type="text" name="query" id="query" class="autocomplete"
			data-url="@{routes.Application.autocomplete()}"
			placeholder="query"
			@if(query != "") {value="@query"} />
		<button type="submit" class="btn">Search</button>
	    <script>
	    $('input.autocomplete').each( function() {
	        var $input = $(this);
	        var serverUrl = $input.data('url');
	        $input.autocomplete({ source:serverUrl });
	    });
	    </script>
    </form>

	<h2>Sample requests</h2>
	<p>Some clickable sample requests (omit the <code>format=page</code> parameter for JSON-LD output and send an accept header for different formats, see details above):</p>
	<table class="table">
		<tr>
			<th>Lobid-Resources, by ID</th>
			<th>Lobid-Resources, by Author</th>
			<th>Lobid-Organisations, by Title</th>
			<th>GND, by Author</th>
		</tr>
		<tr>
			@defining("/id/HT002189125?format=page"){ref => <td><a href="@ref">@ref</a></td>}
			@defining("/author/Abramson?format=page"){ref => <td><a href="@ref">@ref</a></td>}
			@defining("/title/UniversitÃ¤t?index="+Index.LOBID_ORGANISATIONS.id()+"&format=page"){ref => <td><a href="@ref">@ref</a></td>}
			@defining("/author/Johann%20Sebastian%20Bach?index="+Index.GND.id()+"&format=page"){ref => <td><a href="@ref">@ref</a></td>}
		</tr>
	</table>
}
