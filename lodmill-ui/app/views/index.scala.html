@* Copyright 2012-2013 Fabian Steeg, hbz. Licensed under the Eclipse Public License 1.0 *@

@import controllers.Serialization
@import models.Index

@withPage(link:String) = {@link&format=page}

@main("Lobid API - Index") {

    <h2>API endpoints and parameters</h2>
    <p>Available endpoints and sample requests (all use GET; omit the <code>format=page</code> parameter for JSON-LD output; send an accept header for different RDF formats, see details below):</p>
    <table class="table table-striped">
		<tr>
			<th style="width: 10%">Parameters &rarr; <br/>&darr; Endpoint</th>
			<th><code>id</code></th>
			<th><code>name</code></th>
			<th><code>author</code></th>
			<th><code>subject</code></th>
			<th style="width: 10%"><code>format</code></th>
			<th style="width: 10%">Info</th>
		</tr>
		<tr>
			<td><code>/resource</td>
			@defining(("/resource?id=HT002189125", "/resource?id=0940450003", "/resource/HT002189125", "/resource/0940450003")){refs =>
				<td>
					<a href="@withPage(refs._1)">@refs._1</a> <br/>
					<a href="@withPage(refs._2)">@refs._2</a> <br/>
					<a href="@refs._3?format=page">@refs._3</a><br/>
					<a href="@refs._4?format=page">@refs._4</a>
				</td>}
			@defining("/resource?name=Faust"){ref => <td><a href="@withPage(ref)">@ref</a></td>}
			@defining(("/resource?author=118580604","/resource?author=Abramson")){ refs =>
				<td><a href="@withPage(refs._1)">@refs._1</a> <br/> <a href="@withPage(refs._2)">@refs._2</a></td>}
			@defining("/resource?subject=44141956"){ref =>
				<td><a href="@withPage(ref)">@ref</a> <br/> (available after reindexing) <br/> TODO: <pre>/resource?subject=Politik</pre></td>}
			<td><code>short</code>, <code>page</code>, <code>full</code> (default)</td>
			<td>Title data <br/> (lobid-resources)</td>
		</tr>
		<tr>
			<td><code>/organisation</td>
			@defining(("/organisation?id=SzBaU","/organisation/SzBaU")){refs =>
				<td>
					<a href="@withPage(refs._1)">@refs._1</a> <br/>
					<a href="@refs._2?format=page">@refs._2</a>
				</td> }
			@defining("/organisation?name=UniversitÃ¤t"){ref => <td><a href="@withPage(ref)">@ref</a></td>}
			<td>&mdash;</td>
			<td>&mdash;</td>
			<td><code>short</code>, <code>page</code>, <code>full</code> (default)</td>
			<td>Authority data <br/> (lobid-organisations)</td>
		</tr>
		<tr>
			<td><code>/person</td>
			@defining(("/person?id=118580604","/person/118580604")){refs =>
				<td>
					<a href="@withPage(refs._1)">@refs._1</a> <br/>
					<a href="@refs._2?format=page">@refs._2</a>
				</td>}
			@defining("/person?name=Johann+Sebastian+Bach"){ref => <td><a href="@withPage(ref)">@ref</a></td>}
			<td>&mdash;</td>
			<td>&mdash;</td>
			<td><code>short</code>, <code>page</code>, <code>full</code> (default)</td>
			<td>Authority data <br/> (GND)</td>
		</tr>
		<tr>
			<td><code>/search</td>
			@defining("/search?id=HT002189125"){ref => <td><a href="@ref">@ref</a></td>}
			@defining("/search?name=Basel"){ref => <td><a href="@ref">@ref</a></td>}
			<td>&mdash;</td>
			<td>&mdash;</td>
			<td><code>short</code>, <code>full</code> (default)</td>
			<td>Search all <br/> (nested JSON result)
		</tr>
	</table>
	<p>In addition to the missing API above (see TODO) we plan to offer <code>concept</code>, <code>location</code>, and <code>event</code> authority data endpoints.</p>

	<h2>API sample usage: auto-suggest</h2>
	<p>Type an author name to get suggestions. Search will return resources with the selected author.</p>
	<div>
	<form method="GET" class="form-inline" action="/resource"> <!-- use full URL in your code, i.e. http://api.lobid.org/resource -->
		<input type="text" class="search" name="author" id="author" style="width:300px"/>
		<input type="hidden" name="format" value="page"/> <!-- to get JSON, omit the 'format' param -->
		<button type="submit" class="btn">Search</button>
	</form>
	<p>This calls the <code>/resource</code> endpoint with the <code>format=short</code> parameter to get the suggestions. See source of this page for the implementation using JavaScript and jQuery UI.</p>
	<script>
		$('input.search').each(function() {
			var $input = $(this);
			$input.autocomplete({
				source : function(request, response) {
					$.ajax({
						// Get the autocomplete data from a remote URL (i.e. a different server from the one that
						// serves this HTML) by using JSONP (use full URL in your code, i.e. http://api.lobid.org/resource):
						url : "/resource",
						dataType : "jsonp",
						data : {
							author : request.term,
							format : "short"
						},
						success : function(data) {
							response(data);
						}
					});
				}
			});
		});
	</script>

	<h2>Content Negotiation</h2>
	<p>To return different RDF serializations as the result format (default is JSON-LD), you can specify an accept header, e.g. for N-Triples:</p>
	<pre>curl --header "Accept: text/plain" http://api.lobid.org/resource/HT002189125</pre>
	<p>Currently supported: @Serialization.values().map((s:Serialization) => s.name + " " + s.getTypes).mkString(", ")</p>
}
