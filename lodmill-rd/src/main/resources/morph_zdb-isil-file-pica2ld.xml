<?xml version="1.0" encoding="UTF-8"?>
<metamorph xmlns="http://www.culturegraph.org/metamorph" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	version="1">
	<rules>
		<!-- @TODO use entities instead of this bnode workaround, see http://list-archives.org/2013/04/11/culturegraph-lists-d-nb-de/metamorph-grouping-entites-based-on-entity-suffixes/f/2259106227 -->
		<!-- General attributes for each record: -->
		<data source="008H.e" name="subject">
			<regexp match="(.*)" format="http://lobid.org/organisation/${1}"/>
		</data>
		<data source="008H.e" name="http://purl.org/dc/terms/identifier">
		</data>
		<data source="008H.e" name="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">
			<regexp match=".*" format="http://xmlns.com/foaf/0.1/Organization"/>
		</data>
		<data source="008H.e" name="http://xmlns.com/foaf/0.1/isPrimaryTopicOf">
			<regexp match="(.*)"
				format="http://dispatch.opac.d-nb.de/DB=1.2/CMD?ACT=SRCHA&amp;IKT=8529&amp;TRM=${1}"/>
		</data>
		<data source="008H.e" name="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">
			<regexp match=".*" format="http://xmlns.com/foaf/0.1/Organization"/>
		</data>
		<!-- links to dbpedia and wikipedia. Urlencode the links, since ntriple serialization is 
			in ascii and jena library uses escaped unicode, which breaks the links -->
		<data source="008H.e" name="@titleUnencoded">
			<lookup in="isil2dbpedia_map"/>
		</data>
		<combine name="http://purl.org/ontology/mo/wikipedia" value="http://de.wikipedia.org/wiki/${titleEncoded}">
			<data source="@titleUnencoded" name="titleEncoded">
			</data>
		</combine>
		<combine name="http://www.w3.org/2000/01/rdf-schema#seeAlso" value="http://dbpedia.org/resource/${titleEncoded}">
			<data source="@titleUnencoded" name="titleEncoded">
			</data>
		</combine>
		<!-- it is save to generate a bnode for geo-location in every record -->
		<data source="008H.e" name="http://www.w3.org/2003/01/geo/wgs84_pos#location">
			<regexp match=".*" format="_:c"/>
		</data>
		<combine name="bnode" value="_:c http://www.w3.org/2003/01/geo/wgs84_pos#long ${long}">
			<data source="008H.e" name="long">
				<lookup in="geolocation-long_map"/>
			</data>
		</combine>
		<combine name="bnode" value="_:c http://www.w3.org/2003/01/geo/wgs84_pos#lat ${lat}">
			<data source="008H.e" name="lat">
				<lookup in="geolocation-lat_map"/>
			</data>
		</combine>
		<combine name="http://www.w3.org/2006/vcard/ns#url" value="${hp}" sameEntity="true">
			<data source="009Q.u" name="hp">
			</data>
			<data source="009Q.z" name="">
				<regexp match="A" format=""/>
			</data>
		</combine>
		<combine name="http://purl.org/ontology/daia/provides" value="${url}"
			sameEntity="true">
			<data source="009Q.u" name="url">
			</data>
			<data source="009Q.z" name="">
				<regexp match="B" format=""/>
			</data>
		</combine>
		<data source="029A.a" name="http://xmlns.com/foaf/0.1/name">
			<!-- sanitize entries like "Ruhr-Universita\u0308t Bochum,\n\t\t\t\t\tUniversita\u0308tsbibliothek" -->
			<replace pattern="\t|\n|\(\s\)\s+" with=""/>
		</data>
		<!-- assuming that if 032P appears there are entries for a vcard:adr -->
		<data source="032P.*" name="http://www.w3.org/2006/vcard/ns#adr">
			<regexp match=".*" format="_:a"/>
		</data>
		<data source="032P.*" name="bnode">
			<regexp match=".*"
				format="_:a http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2006/vcard/ns#Address"/>
		</data>
		<data source="032P.*" name="bnode">
			<regexp match=".*"
				format="_:a http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2006/vcard/ns#Work"/>
		</data>
		<data source="032P.a" name="bnode">
			<regexp match="(.*)" format="_:a http://www.w3.org/2006/vcard/ns#street-address ${1}"/>
		</data>
		<data source="032P.b" name="bnode">
			<regexp match="(.*)" format="_:a http://www.w3.org/2006/vcard/ns#locality ${1}"/>
		</data>
		<!-- there are sometimes double 032P, one for the city and one for the adress -->
		<combine name="bnode" value="_:a http://www.w3.org/2006/vcard/ns#postal-code ${plz}"
			sameEntity="true">
			<data source="032P.e" name="plz"/>
			<data source="032P.a" name=""/>
		</combine>
		<combine name="bnode" value="_:a http://www.w3.org/2006/vcard/ns#country-name ${country}">
			<data source="032P.d" name="country">
				<lookup in="country-map"/>
			</data>
		</combine>
		<data source="032P.i" name="http://purl.org/goodrelations/v1#hasOpeningHoursSpecification">
			<regexp match="(.*)" format="_:b"/>
		</data>
		<data source="032P.i" name="bnode">
			<regexp match="(.*)" format="_:b http://purl.org/dc/terms/description ${1}"/>
		</data>
				<data source="032P.i" name="bnode">
			<regexp match="(.*)" format="_:b http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://purl.org/goodrelations/v1#OpeningHoursSpecification"/>
		</data>
		<data source="032P.k" name="bnode">
			<regexp match="(.*)"
				format="_:c http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing"/>
		</data>
		<data source="032P.k" name="bnode">
			<regexp match="(.*)" format="_:c http://www.w3.org/2003/01/geo/wgs84_pos#long ${1}"/>
		</data>
		<data source="032P.l" name="bnode">
			<regexp match="(.*)" format="_:c http://www.w3.org/2003/01/geo/wgs84_pos#lat ${1}"/>
		</data>
		<data source="032P.n" name="http://www.geonames.org/ontology#locatedIn">
		</data>
		<!-- phone as bnode -->
		<data source="035B.f" name="http://www.w3.org/2006/vcard/ns#tel">
			<regexp match="(.*)" format="_:d"/>
		</data>
		<data source="035B.f" name="bnode">
			<regexp match="(.*)"
				format="_:d http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2006/vcard/ns#Voice"/>
		</data>
		<data source="035B.f" name="bnode">
			<regexp match="(.*)"
				format="_:d http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2006/vcard/ns#Work"/>
		</data>
		<combine name="bnode"
			value="_:d http://www.w3.org/1999/02/22-rdf-syntax-ns#value (0${prefix}) ${phonenr}"
			sameEntity="true">
			<data source="035B.e" name="prefix">
			</data>
			<data source="035B.f" name="phonenr">
			</data>
		</combine>
		<data source="035B.f" name="bnode">
			<regexp match="(.*)"
				format="_:d http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2006/vcard/ns#Work"/>
		</data>
		<!-- /phone as bnode -->
		<!-- fax as bnode -->
		<data source="035B.i" name="http://www.w3.org/2006/vcard/ns#tel">
			<regexp match="(.*)" format="_:e"/>
		</data>
		<data source="035B.i" name="bnode">
			<regexp match="(.*)"
				format="_:e http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2006/vcard/ns#Fax"/>
		</data>
		<data source="035B.i" name="bnode">
			<regexp match="(.*)"
				format="_:e http://www.w3.org/1999/02/22-rdf-syntax-ns#type http://www.w3.org/2006/vcard/ns#Work"/>
		</data>
		<combine name="bnode"
			value="_:e http://www.w3.org/1999/02/22-rdf-syntax-ns#value (0${prefix}) ${faxnr}"
			sameEntity="true">
			<data source="035B.h" name="prefix">
			</data>
			<data source="035B.i" name="faxnr">
			</data>
		</combine>
		<!-- /fax as bnode -->
		<data source="035B.k" name="http://www.w3.org/2006/vcard/ns#email">
			<regexp match="(.*)" format="mailto:${1}"/>
		</data>
		<data source="035E.f" name="http://www.w3.org/ns/org#classification">
			<regexp match="(.*)" format="http://purl.org/lobid/libtype#n${1}"/>
		</data>
		<data source="035E.g" name="http://purl.org/lobid/lv#fundertype">
			<regexp match="(.*)" format="http://purl.org/lobid/fundertype#n${1}"/>
		</data>
		<data source="035E.h" name="http://purl.org/lobid/lv#stocksize">
			<regexp match="(.*)" format="http://purl.org/lobid/stocksize#n${1}"/>
		</data>
		<data source="035G.a" name="http://purl.org/dc/terms/subject">
		</data>
		<data source="035I.c" name="http://www.w3.org/ns/org#linkedTo">
			<regexp match="(?i).*gbv" format="http://lobid.org/organisation/DE-601"/>
		</data>
		<data source="035I.c" name="http://www.w3.org/ns/org#linkedTo">
			<regexp match="(?i).*bvb" format="http://lobid.org/organisation/DE-604"/>
		</data>
		<data source="035I.c" name="http://www.w3.org/ns/org#linkedTo">
			<regexp match="(?i).*hebis" format="http://lobid.org/organisation/DE-603"/>
		</data>
		<data source="035I.c" name="http://www.w3.org/ns/org#linkedTo">
			<regexp match="(?i).*hbz" format="http://lobid.org/organisation/DE-605"/>
		</data>
		<data source="035I.c" name="http://www.w3.org/ns/org#linkedTo">
			<regexp match="(?i).*kobv" format="http://lobid.org/organisation/DE-602"/>
		</data>
		<data source="035I.c" name="http://www.w3.org/ns/org#linkedTo">
			<regexp match="(?i).*swb" format="http://lobid.org/organisation/DE-576"/>
		</data>
	</rules>
	<maps>
		<mapfile name="country-map" files="country-map.csv"/>
		<!-- transformations/include/ -->
		<mapfile name="geolocation-long_map"
			files="geolocation-long_map.csv"/>
		<mapfile name="geolocation-lat_map"
			files="geolocation-lat_map.csv"/>
		<mapfile name="isil2dbpedia_map" files="isil2dbpedia_map.csv"/>
	</maps>
</metamorph>