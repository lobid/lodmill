<?xml version="1.0" encoding="UTF-8"?>
<metamorph xmlns="http://www.culturegraph.org/metamorph" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	version="1">
	<rules>	<!-- NRW geoLocation -->
		<data source="nwbib700_99" name="@nwbib700_99_id">
			<replace pattern=" " with=""/>
			<replace pattern="/" with=""/>
			<replace pattern="\(" with=""/>
			<replace pattern="\)" with=""/>
			<replace pattern="&lt;" with=""/>
			<replace pattern="&gt;" with=""/>
			<replace pattern="-" with=""/>
			<replace pattern="," with=""/>
			<replace pattern="/" with=""/>
		</data>
		<data source="@nwbib700_99_id" name="@osmTypeAndId">
			<lookup in="osmTypeAndId"/>
		</data>
		<!-- generate different URL's depending if there are "Ordnungszeichen" -->
		<combine name="url"
			value="http://nominatim.openstreetmap.org/search?q=${url}%20Nordrhein-Westfalen&amp;limit=1&amp;format=json&amp;addressdetails=1&amp;json_callback=${id}">
			<if>
				<none>
					<data source="@osmTypeAndId"/>
				</none>
			</if>
			<data source="@nwbib700_99_id" name="id"/>
			<data source="@url" name="url"/>
		</combine>
		<data source="nwbib700_99" name="@url">
			<replace pattern="&lt;" with=" "/>
			<replace pattern="&gt;" with=" "/>
			<urlescape></urlescape>
		</data>
		<!-- /geoLocation -->
		<data source="@nwbib700_99_id" name="@geonamesId">
			<lookup in="placesGeonames"/>
		</data>
	</rules>
	<maps>
		<!-- tsv of iso31661a country codes to geoname ID's -->
		<sqlmap name="placesGeonames" query="SELECT data FROM NrwPlacesGeonamesId WHERE identifier=?"
			host="localhost:3306" database="lobid" login="debian-sys-maint" password="tzSblDEUGC1XhJB7"/>
		<sqlmap name="osmTypeAndId" query="SELECT data FROM NrwPlacesOsmUrl WHERE identifier=?"
			host="localhost:3306" database="lobid" login="debian-sys-maint" password="tzSblDEUGC1XhJB7"/>
	</maps>
</metamorph>